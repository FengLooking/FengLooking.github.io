<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Docker - dyfblogs</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="dyf" />
  <meta name="description" content="镜像搜索操作 搜索镜像： docker search image_name 搜索结果过滤是否官方镜像： docker search --filter &amp;#34;is-official=true&amp;#34; image_name 搜索结果过滤是否自动化构建： docker search --filter &amp;#34;is-automated=true&amp;#34; image_name 搜索结果过滤大于多少颗星： docker search --filter stars=3 image_name 列" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.57.2" />


<link rel="canonical" href="http://www.dyfblogs.com/post/docker_basic/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.767e8d19348cc668e31b1e043ece58a4e41f5a6ef892b2b2935a57a23b63bae9.css" integrity="sha256-dn6NGTSMxmjjGx4EPs5YpOQfWm74krKyk1pXojtjuuk=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Docker" />
<meta property="og:description" content="镜像搜索操作 搜索镜像： docker search image_name 搜索结果过滤是否官方镜像： docker search --filter &#34;is-official=true&#34; image_name 搜索结果过滤是否自动化构建： docker search --filter &#34;is-automated=true&#34; image_name 搜索结果过滤大于多少颗星： docker search --filter stars=3 image_name 列" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.dyfblogs.com/post/docker_basic/" />
<meta property="article:published_time" content="2019-10-22T20:21:56+08:00" />
<meta property="article:modified_time" content="2019-10-22T21:50:01+08:00" />
<meta itemprop="name" content="Docker">
<meta itemprop="description" content="镜像搜索操作 搜索镜像： docker search image_name 搜索结果过滤是否官方镜像： docker search --filter &#34;is-official=true&#34; image_name 搜索结果过滤是否自动化构建： docker search --filter &#34;is-automated=true&#34; image_name 搜索结果过滤大于多少颗星： docker search --filter stars=3 image_name 列">


<meta itemprop="datePublished" content="2019-10-22T20:21:56&#43;08:00" />
<meta itemprop="dateModified" content="2019-10-22T21:50:01&#43;08:00" />
<meta itemprop="wordCount" content="2505">



<meta itemprop="keywords" content="docker," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker"/>
<meta name="twitter:description" content="镜像搜索操作 搜索镜像： docker search image_name 搜索结果过滤是否官方镜像： docker search --filter &#34;is-official=true&#34; image_name 搜索结果过滤是否自动化构建： docker search --filter &#34;is-automated=true&#34; image_name 搜索结果过滤大于多少颗星： docker search --filter stars=3 image_name 列"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">DYFNOTES</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/">首页</a>
          
      </li><li class="mobile-menu-item">
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/post/">归档</a>
          
      </li><li class="mobile-menu-item">
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/tags/">标签</a>
          
      </li><li class="mobile-menu-item">
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/categories/">归类</a>
          
      </li><li class="mobile-menu-item">
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/about/">关于</a>
          
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      DYFNOTES
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
          
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
          
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
          
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
          
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/categories/">归类</a>
          

        

      </li>
    
        <li class="menu-item">
          
          
          
            <a class="menu-item-link" href="http://www.dyfblogs.com/about/">关于</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white article_content">
    
    <header class="post-header">
      <h1 class="post-title">Docker</h1>
      
      <div class="post-meta">
        <span>发表于</span>
        <time datetime="2019-10-22" class="post-time">
          2019-10-22
        </time>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#镜像搜索操作">镜像搜索操作</a></li>
<li><a href="#列出本地主机上的镜像">列出本地主机上的镜像</a></li>
<li><a href="#创建容器">创建容器</a></li>
<li><a href="#容器基础操作">容器基础操作</a></li>
<li><a href="#查看容器日志">查看容器日志</a></li>
<li><a href="#查看容器的运行">查看容器的运行</a></li>
<li><a href="#进入容器和退出容器">进入容器和退出容器</a></li>
<li><a href="#容器的修改和保存容器修改">容器的修改和保存容器修改</a></li>
<li><a href="#容器内和本地机器间的文件和数据操作">容器内和本地机器间的文件和数据操作</a></li>
<li><a href="#dockerfile">Dockerfile</a></li>
<li><a href="#dockerfile常用命令">Dockerfile常用命令</a></li>
<li><a href="#dockerfile命令总结">Dockerfile命令总结</a></li>
<li><a href="#一个dockerfile例子">一个Dockerfile例子</a></li>
<li><a href="#docker执行dockerfile的流程">docker执行Dockerfile的流程</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h4 id="镜像搜索操作">镜像搜索操作</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">搜索镜像</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">search</span> <span style="color:#a6e22e">image_name</span>
<span style="color:#a6e22e">搜索结果过滤是否官方镜像</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">search</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">filter</span> <span style="color:#e6db74">&#34;is-official=true&#34;</span> <span style="color:#a6e22e">image_name</span>
<span style="color:#a6e22e">搜索结果过滤是否自动化构建</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">search</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">filter</span> <span style="color:#e6db74">&#34;is-automated=true&#34;</span> <span style="color:#a6e22e">image_name</span>
<span style="color:#a6e22e">搜索结果过滤大于多少颗星</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">search</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">filter</span> <span style="color:#a6e22e">stars</span>=<span style="color:#ae81ff">3</span> <span style="color:#a6e22e">image_name</span></code></pre></div>

<h4 id="列出本地主机上的镜像">列出本地主机上的镜像</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">列出本地所有的镜像</span><span style="color:#960050;background-color:#1e0010">（</span><span style="color:#a6e22e">包含中间映像层</span><span style="color:#960050;background-color:#1e0010">）</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">images</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">a</span>
<span style="color:#a6e22e">只显示镜像ID</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">images</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">q</span>
<span style="color:#a6e22e">显示镜像的摘要信息</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">images</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">digests</span>
<span style="color:#a6e22e">显示完整的镜像信息</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">images</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">notrunc</span></code></pre></div>

<h4 id="创建容器">创建容器</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">itd</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">name</span>=<span style="color:#a6e22e">container_name</span> <span style="color:#a6e22e">image_name</span>
<span style="color:#a6e22e">参数说明</span><span style="color:#960050;background-color:#1e0010">：</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span>: <span style="color:#a6e22e">表示以交互模式运行容器</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">d</span>: <span style="color:#a6e22e">表示后台运行容器</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">并返回容器ID</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">t</span>: <span style="color:#a6e22e">为容器重新分配一个伪输入终端</span>
    <span style="color:#f92672">--</span><span style="color:#a6e22e">name</span>: <span style="color:#a6e22e">为容器指定名称</span></code></pre></div>

<h4 id="容器基础操作">容器基础操作</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">查看运行中的容器</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">ps</span>
<span style="color:#a6e22e">查看所有容器</span>(<span style="color:#a6e22e">包括已停止</span>)<span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">ps</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">a</span>
<span style="color:#a6e22e">停止容器</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">stop</span> <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span>
<span style="color:#a6e22e">启动容器</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">start</span> <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span>
<span style="color:#a6e22e">重启容器</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">restart</span> <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span>
<span style="color:#a6e22e">删除容器</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">rm</span> <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span></code></pre></div>

<h4 id="查看容器日志">查看容器日志</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">logs</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">t</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">tail</span> <span style="color:#ae81ff">900</span> <span style="color:#a6e22e">container_id</span>
<span style="color:#a6e22e">参数说明</span><span style="color:#960050;background-color:#1e0010">：</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span>: <span style="color:#a6e22e">跟随最新的日志</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">t</span>: <span style="color:#a6e22e">加入时间戳</span>
    <span style="color:#f92672">--</span><span style="color:#a6e22e">tail</span> <span style="color:#ae81ff">900</span>: <span style="color:#a6e22e">显示最后面的900条日志</span></code></pre></div>

<h4 id="查看容器的运行">查看容器的运行</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">查看容器内运行的进程</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">top</span> <span style="color:#a6e22e">container_id</span>
<span style="color:#a6e22e">查看容器内部细节</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">inspect</span> <span style="color:#a6e22e">container_id</span></code></pre></div>

<h4 id="进入容器和退出容器">进入容器和退出容器</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">进入容器</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">exec</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">it</span> <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bash</span>
<span style="color:#a6e22e">退出容器</span>
<span style="color:#a6e22e">exit</span></code></pre></div>

<h4 id="容器的修改和保存容器修改">容器的修改和保存容器修改</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">提交容器修改</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">commit</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">a</span> <span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">m</span> <span style="color:#e6db74">&#34;commit message&#34;</span> <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span> <span style="color:#a6e22e">new_image_name</span>:<span style="color:#a6e22e">tag_name</span>
<span style="color:#a6e22e">参数说明</span><span style="color:#960050;background-color:#1e0010">：</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">a</span>: <span style="color:#a6e22e">可选</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">指定作者</span>
    <span style="color:#f92672">-</span><span style="color:#a6e22e">m</span>: <span style="color:#a6e22e">可选</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">提交信息</span>
    <span style="color:#a6e22e">container_name</span><span style="color:#f92672">/</span><span style="color:#a6e22e">container_id</span>: <span style="color:#a6e22e">容器名或者容器ID</span>
    <span style="color:#a6e22e">new_image_name</span>: <span style="color:#a6e22e">镜像名</span>
    <span style="color:#a6e22e">tag_name</span>: <span style="color:#a6e22e">镜像标签</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">不写时默认标签为latest</span></code></pre></div>

<h4 id="容器内和本地机器间的文件和数据操作">容器内和本地机器间的文件和数据操作</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">端口映射</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">itd</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#a6e22e">机器端口号</span>:<span style="color:#a6e22e">容器端口号</span>
<span style="color:#a6e22e">文件挂载</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">itd</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">v</span> <span style="color:#a6e22e">机器目录</span>:<span style="color:#a6e22e">容器目录</span>
<span style="color:#a6e22e">将容器的文件复制到本地</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">cp</span> <span style="color:#a6e22e">容器名</span>:<span style="color:#f92672">/</span><span style="color:#a6e22e">容器目录</span><span style="color:#f92672">/</span><span style="color:#a6e22e">文件名</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">机器目录</span><span style="color:#f92672">/</span><span style="color:#a6e22e">文件名</span>
<span style="color:#a6e22e">将机器本地的文件复制到容器</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">cp</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">机器目录</span><span style="color:#f92672">/</span><span style="color:#a6e22e">文件名</span> <span style="color:#a6e22e">容器名</span>:<span style="color:#f92672">/</span><span style="color:#a6e22e">容器目录</span><span style="color:#f92672">/</span><span style="color:#a6e22e">文件名</span>
<span style="color:#a6e22e">容器互联</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">itd</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">link</span> <span style="color:#a6e22e">要关联的容器名字</span>:<span style="color:#a6e22e">容器在被关联的容器中的别名</span></code></pre></div>

<h4 id="dockerfile">Dockerfile</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">Dockerfile</span> <span style="color:#a6e22e">是一个内容包含以下linux命令的文件</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">docker通过读取文件中的命令来创建镜像</span><span style="color:#960050;background-color:#1e0010">。</span>
<span style="color:#a6e22e">Dockerfile</span> <span style="color:#a6e22e">一般分为四个部分</span><span style="color:#960050;background-color:#1e0010">：</span><span style="color:#a6e22e">基础镜像信息</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">维护者信息</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">镜像操作指令</span> <span style="color:#a6e22e">和</span> <span style="color:#a6e22e">容器启动时的执行指令</span>
<span style="color:#a6e22e">Dockerfile的运行</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">build</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">t</span> <span style="color:#a6e22e">image_name</span>:<span style="color:#a6e22e">tag_name</span> .
<span style="color:#a6e22e">或者</span>
<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">build</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">path</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Dockerfile</span> .</code></pre></div>

<h4 id="dockerfile常用命令">Dockerfile常用命令</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">FROM</span>: <span style="color:#a6e22e">第一个命令</span>(<span style="color:#a6e22e">且必须为第一个</span>)<span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">指定基础镜像</span>
<span style="color:#960050;background-color:#1e0010">‘’‘</span>
<span style="color:#a6e22e">格式如下</span>:
   <span style="color:#a6e22e">FROM</span> &lt;<span style="color:#a6e22e">image_name</span>&gt;
   <span style="color:#a6e22e">FROM</span> &lt;<span style="color:#a6e22e">image_name</span>&gt;:&lt;<span style="color:#a6e22e">tag</span>&gt;
   <span style="color:#a6e22e">FROM</span> &lt;<span style="color:#a6e22e">image_name</span>&gt;<span style="color:#960050;background-color:#1e0010">@</span>&lt;<span style="color:#a6e22e">digest</span>&gt;
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">centos</span>:<span style="color:#ae81ff">7.0</span>
<span style="color:#960050;background-color:#1e0010">’‘’</span>

<span style="color:#a6e22e">MAINTAINER</span>: <span style="color:#a6e22e">维护者信息</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">MAINTAINER</span> &lt;<span style="color:#a6e22e">username</span>&gt;
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">MAINTAINER</span> <span style="color:#a6e22e">yanfeici</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">RUN</span>: <span style="color:#a6e22e">构建镜像是执行的命令</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">RUN</span> &lt;<span style="color:#a6e22e">command</span>&gt;
   <span style="color:#a6e22e">或者</span>
   <span style="color:#a6e22e">RUN</span> [<span style="color:#e6db74">&#34;executable&#34;</span>, <span style="color:#e6db74">&#34;param1&#34;</span>, <span style="color:#e6db74">&#34;param2&#34;</span>]
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">yum</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">nginx</span>
   <span style="color:#a6e22e">RUN</span> [<span style="color:#e6db74">&#34;/bin/executable&#34;</span>, <span style="color:#e6db74">&#34;param1&#34;</span>, <span style="color:#e6db74">&#34;param2&#34;</span>]
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">ADD</span>: <span style="color:#a6e22e">将本地文件添加到容器中</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">tar类型文件会自动解压</span>(<span style="color:#a6e22e">网络压缩资源不会被解压</span>),<span style="color:#a6e22e">可以访问网路资源</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">类似wget</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">ADD</span> &lt;<span style="color:#a6e22e">src</span>&gt; &lt;<span style="color:#a6e22e">dest</span>&gt;
   <span style="color:#a6e22e">ADD</span> [<span style="color:#e6db74">&#34;&lt;src&gt;&#34;</span>, <span style="color:#e6db74">&#34;&lt;dest&gt;&#34;</span>]
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">ADD</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">*</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">mydir</span><span style="color:#f92672">/</span>    <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">添加所有以test开头的文件到</span><span style="color:#f92672">/</span><span style="color:#a6e22e">mydir</span><span style="color:#f92672">/</span>
   <span style="color:#a6e22e">ADD</span> <span style="color:#a6e22e">tes</span><span style="color:#960050;background-color:#1e0010">?</span>.<span style="color:#a6e22e">txt</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">mydir</span><span style="color:#f92672">/</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">?</span><span style="color:#a6e22e">替代一个单字符</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">如</span><span style="color:#960050;background-color:#1e0010">：</span><span style="color:#a6e22e">test</span>.<span style="color:#a6e22e">txt</span>
   <span style="color:#a6e22e">ADD</span> <span style="color:#a6e22e">test</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">mydir</span><span style="color:#f92672">/</span>     <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">添加test</span> <span style="color:#a6e22e">到</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">mydir</span><span style="color:#f92672">/</span>
<span style="color:#a6e22e">备注</span><span style="color:#960050;background-color:#1e0010">：</span><span style="color:#a6e22e">第一个路径为机器本地文件路径</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">第二个路径为容器路径</span>
     <span style="color:#a6e22e">COPY的功能类似ADD</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">但是不会自动解压文件</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">也不能访问网络资源</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">CMD</span>: <span style="color:#a6e22e">构建容器后调用</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">也就是在容器启动时才进行调用</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">CMD</span> [<span style="color:#e6db74">&#34;executable&#34;</span>, <span style="color:#e6db74">&#34;param1&#34;</span>, <span style="color:#e6db74">&#34;param2&#34;</span>]
   <span style="color:#a6e22e">CMD</span> [<span style="color:#e6db74">&#34;param1&#34;</span>, <span style="color:#e6db74">&#34;param2&#34;</span>]
   <span style="color:#a6e22e">CMD</span> <span style="color:#a6e22e">command</span> <span style="color:#a6e22e">param1</span> <span style="color:#a6e22e">param2</span>
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">CMD</span> <span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;test&#34;</span> | <span style="color:#a6e22e">wc</span> <span style="color:#f92672">-</span>
   <span style="color:#a6e22e">CMD</span> [<span style="color:#e6db74">&#34;/usr/bin/wc&#34;</span>, <span style="color:#e6db74">&#34;--help&#34;</span>]
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">CMD和RUN不同</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">CMD用于指定在容器启动时所需要执行的命令</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">而RUN用于指定镜像构建时所要执行的命令</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">ENTRYPOINT</span>: <span style="color:#a6e22e">配置容器</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">使其可执行化</span><span style="color:#960050;background-color:#1e0010">。</span><span style="color:#a6e22e">配合CMD可省去</span><span style="color:#e6db74">&#34;application&#34;</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">只使用参数</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;executable&#34;</span>, <span style="color:#e6db74">&#34;param1&#34;</span>, <span style="color:#e6db74">&#34;param2&#34;</span>]
   <span style="color:#a6e22e">ENTRYPOINT</span> <span style="color:#a6e22e">command</span> <span style="color:#a6e22e">param1</span> <span style="color:#a6e22e">param2</span>
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;top&#34;</span>, <span style="color:#e6db74">&#34;-b&#34;</span>]
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">ENTRYPOINT和CMD非常类似</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">不同的是通过docker</span> <span style="color:#a6e22e">run执行的命令不会覆盖ENTRYPOINT</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">而docker</span> <span style="color:#a6e22e">run命令中指定的任何参数</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">都会被当作参数再次传递给ENTRYPOINT</span><span style="color:#960050;background-color:#1e0010">。</span><span style="color:#a6e22e">Dockerfile中只允许有一个ENTRYPOINT命令</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">多指定时会覆盖前面的设置</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">而只执行最后的ENTRYPOINT指令</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">LABEL</span>: <span style="color:#a6e22e">用于为镜像添加元数据</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">LABEL</span> &lt;<span style="color:#a6e22e">key</span><span style="color:#f92672">&gt;=</span>&lt;<span style="color:#a6e22e">value</span>&gt; &lt;<span style="color:#a6e22e">key</span><span style="color:#f92672">&gt;=</span>&lt;<span style="color:#a6e22e">value</span>&gt; <span style="color:#f92672">...</span>
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">LABEL</span> <span style="color:#a6e22e">version</span>=<span style="color:#e6db74">&#34;2.0&#34;</span> <span style="color:#a6e22e">description</span>=<span style="color:#e6db74">&#34;this is a test image&#34;</span>
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">使用LABEL指定元数据时</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">一条LABEL指定可以指定一条或者多条元数据</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">指定多条元数据时不同元数据之间通过空格分隔</span><span style="color:#960050;background-color:#1e0010">。</span><span style="color:#a6e22e">推荐将所有的元数据通过一条LABEL指令来指定</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">以免生产过多的中间镜像</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">ENV</span>: <span style="color:#a6e22e">设置环境变量</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">ENV</span> &lt;<span style="color:#a6e22e">key</span>&gt; &lt;<span style="color:#a6e22e">value</span>&gt;    <span style="color:#960050;background-color:#1e0010">#</span> &lt;<span style="color:#a6e22e">key</span>&gt;<span style="color:#a6e22e">之后的所有内容均会被视为其</span>&lt;<span style="color:#a6e22e">value</span>&gt;<span style="color:#a6e22e">的组成部分</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">因此一次只能设置一个变量</span>
   <span style="color:#a6e22e">ENV</span> &lt;<span style="color:#a6e22e">key</span><span style="color:#f92672">&gt;=</span>&lt;<span style="color:#a6e22e">value</span>&gt;<span style="color:#f92672">...</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">可以设置多个变量</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">如果key中包含空格</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">可以使用</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">来转义</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">也可以使用</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#a6e22e">来标识</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">且反斜线可以用来续行</span>
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">ENV</span> <span style="color:#a6e22e">username</span> <span style="color:#a6e22e">tom</span> <span style="color:#a6e22e">smith</span>
   <span style="color:#a6e22e">ENV</span> <span style="color:#a6e22e">username</span>=<span style="color:#a6e22e">tomsmith</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">EXPOSE</span>: <span style="color:#a6e22e">指定与外界交互的端口</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">EXPOSE</span> &lt;<span style="color:#a6e22e">port</span>&gt; [&lt;<span style="color:#a6e22e">port</span>&gt;<span style="color:#f92672">...</span>]
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">EXPOSE</span> <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">8080</span>
   <span style="color:#a6e22e">EXPOSE</span> <span style="color:#ae81ff">8443</span>
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">EXPOSE不会让容器的端口访问到主机</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">要使其可以访问</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">需要在docker</span> <span style="color:#a6e22e">run运行容器时通过</span><span style="color:#f92672">-</span><span style="color:#a6e22e">p来发布这些端口</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">或者通过</span><span style="color:#f92672">-</span><span style="color:#a6e22e">P参数来发布EXPOSE导出的所有端口</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">VOLUME</span>: <span style="color:#a6e22e">指定持久化目录</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">VOLUME</span> [<span style="color:#e6db74">&#34;/path/to/dir&#34;</span>]
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">VOLUME</span> [<span style="color:#e6db74">&#34;/data&#34;</span>]
   <span style="color:#a6e22e">VOLUME</span> [<span style="color:#e6db74">&#34;/var/www&#34;</span>, <span style="color:#e6db74">&#34;/home/html&#34;</span>, <span style="color:#e6db74">&#34;/etc/nginx&#34;</span>]
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">一个卷可以存在于一个或者多个容器的指定目录</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">该目录可以绕过联合文件系统并具有以下功能</span><span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#ae81ff">1.</span> <span style="color:#a6e22e">可以容器间共享重用</span>
<span style="color:#ae81ff">2.</span> <span style="color:#a6e22e">容器并不一定要和其他容器共享卷</span>
<span style="color:#ae81ff">3.</span> <span style="color:#a6e22e">修改卷后会立即生效</span>
<span style="color:#ae81ff">4.</span> <span style="color:#a6e22e">对卷的修改不会对镜像产生影响</span>
<span style="color:#ae81ff">5.</span> <span style="color:#a6e22e">卷会一直存在</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">直到没有任何容器使用它</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">WORKDIR</span>: <span style="color:#a6e22e">工作目录</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">类似cd命令</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">path</span><span style="color:#f92672">/</span><span style="color:#a6e22e">to</span><span style="color:#f92672">/</span><span style="color:#a6e22e">workdir</span>
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">home</span><span style="color:#f92672">/</span><span style="color:#a6e22e">project</span>  <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">home</span><span style="color:#f92672">/</span><span style="color:#a6e22e">project</span>
   <span style="color:#a6e22e">WORKDIR</span> <span style="color:#a6e22e">nginx</span>          <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">local</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span>
   <span style="color:#a6e22e">WORKDIR</span> <span style="color:#a6e22e">sbin</span>           <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">local</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sbin</span>
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">通过WORKDIR设置工作目录后</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">Dockerfile中其后的命令RUN</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">CMD</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">ENTRYPOINT</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">ADD</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">COPY等命令都会在该目录下执行</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">在使用docker</span> <span style="color:#a6e22e">run运行容器时</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">可以通过</span><span style="color:#f92672">-</span><span style="color:#a6e22e">w参数覆盖构建时所设置的工作目录</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">USER</span>: <span style="color:#a6e22e">指定运行容器时的用户名或者UID</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">后续的RUN也会使用指定用户</span><span style="color:#960050;background-color:#1e0010">。</span><span style="color:#a6e22e">使用USER指定用户时</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">可以使用用户名</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">UID或者GID</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">或者两者的组合</span><span style="color:#960050;background-color:#1e0010">。</span><span style="color:#a6e22e">当服务不需要管理员权限时</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">可以通过该命令指定运行用户</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">并且可以在之前创建所需要的用户</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">linux_user</span>
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">user</span>:<span style="color:#a6e22e">group</span>
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">uid</span>
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">uid</span>:<span style="color:#a6e22e">gid</span>
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">user</span>:<span style="color:#a6e22e">gid</span>
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">uid</span>:<span style="color:#a6e22e">group</span>
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">USER</span> <span style="color:#a6e22e">nginx</span>
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">使用USER指定用户后</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">Dockerfile中其后的命令RUN</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">CMD</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">ENTRYPOINT都将使用该用户</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">构建镜像完成后</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">通过docker</span> <span style="color:#a6e22e">run运行容器时</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">可以通过</span><span style="color:#f92672">-</span><span style="color:#a6e22e">u参数来覆盖所指定的用户</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">ARG</span>: <span style="color:#a6e22e">指定传递给构建运行时的变量</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">ARG</span> &lt;<span style="color:#a6e22e">name</span>&gt;[=&lt;<span style="color:#66d9ef">default</span> <span style="color:#a6e22e">value</span>&gt;]
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">ARG</span> <span style="color:#a6e22e">site</span>
   <span style="color:#a6e22e">ARG</span> <span style="color:#a6e22e">build_user</span>=<span style="color:#a6e22e">www</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#a6e22e">ONBUILD</span>: <span style="color:#a6e22e">设置镜像触发器</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#a6e22e">格式如下</span><span style="color:#960050;background-color:#1e0010">：</span>
   <span style="color:#a6e22e">ONBUILD</span> [<span style="color:#a6e22e">INSTRUCTION</span>]
<span style="color:#a6e22e">eg</span>:
   <span style="color:#a6e22e">ONBUILD</span> <span style="color:#a6e22e">ADD</span> . <span style="color:#f92672">/</span><span style="color:#a6e22e">webapp</span><span style="color:#f92672">/</span><span style="color:#a6e22e">src</span>
   <span style="color:#a6e22e">ONBUILD</span> <span style="color:#a6e22e">RUN</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">local</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">python</span><span style="color:#f92672">-</span><span style="color:#a6e22e">build</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">dir</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">app</span><span style="color:#f92672">/</span><span style="color:#a6e22e">src</span>
<span style="color:#a6e22e">备注</span>: <span style="color:#a6e22e">当所构建的镜像被用做其他镜像的基础镜像</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">该镜像中的触发器将会被触发</span>
<span style="color:#e6db74">&#39;&#39;&#39;</span></code></pre></div>

<h4 id="dockerfile命令总结">Dockerfile命令总结</h4>

<p><img src="/image/dockerfile_cmdtree.png" alt="image" /></p>

<h4 id="一个dockerfile例子">一个Dockerfile例子</h4>

<p><img src="/image/dockerfile_eg.png" alt="image" /></p>

<h4 id="docker执行dockerfile的流程">docker执行Dockerfile的流程</h4>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#ae81ff">1.</span> <span style="color:#a6e22e">docker从基础镜像运行一个容器</span>
<span style="color:#ae81ff">2.</span> <span style="color:#a6e22e">执行一条指令并对容器做出修改</span>
<span style="color:#ae81ff">3.</span> <span style="color:#a6e22e">执行类似docker</span> <span style="color:#a6e22e">commit的操作提交一个新的镜像层</span>
<span style="color:#ae81ff">4.</span> <span style="color:#a6e22e">docker再基于刚刚提交的镜像运行一个新的容器</span>
<span style="color:#ae81ff">5.</span> <span style="color:#a6e22e">执行Dockerfile中的其他指令直到所有直到执行完成</span></code></pre></div>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"></code></pre></div>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://www.dyfblogs.com/tags/docker/">docker</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/kubernetes_basic/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Kubernetes</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/centos_install_jdk8/">
            <span class="next-text nav-default">centos7安装jdk8</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      
<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">and</span>
  <span class="theme-info">
    Theme by <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="division">|</span>
  <span class="copyright-year">
    &copy;
    
      2017 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        DYF
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
